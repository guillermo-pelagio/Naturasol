
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>generar_responsiva_pdf</title>
</head>
<body>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="~/Content/DataTables/css/jquery.dataTables.css">
    <link rel="stylesheet" href="~/Content/DataTables/css/responsive.dataTables.css">
    <link rel="stylesheet" href="~/Content/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" type="text/css" href="~/Content/js/select.dataTables.min.css">
    <script src="~/Content/vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="~/Content/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
    <script src="~/Content/js/dataTables.select.min.js"></script>
    <script src="~/Scripts/DataTables/jquery.dataTables.js"></script>
    <script src="~/Scripts/DataTables/dataTables.responsive.js"></script>
    <script src="~/Scripts/DataTables/dataTables.buttons.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Cambay' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.3.5/signature_pad.min.js" integrity="sha512-kw/nRM/BMR2XGArXnOoxKOO5VBHLdITAW00aG8qK4zBzcLVZ4nzg7/oYCaoiwc8U9zrnsO9UHqpyljJ8+iqYiQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!------ Include the above in your HEAD tag ---------->

    <div id="responsiva">
        <div class="responsiva overflow-auto" id="divImpresion">
            <div style="min-width: 600px">
                <header>
                    <h5 class="name" style="text-align: center">
                        Responsiva de entrega de cómputo, accesorios y telefonía
                    </h5>
                    <br />
                    <div class="row">
                        <div class="col">
                            <a target="_blank" href="">
                                @if ((Convert.ToString(Session["sociedad"]) == "MIELMEX S.A. de C.V."))
                                {

                                    < img id="logoResponsiva" src="~/Content/images/logo.png" data-holder-rendered="true" />
                                }
                                else
                                {
                                    <img id="logoResponsiva" src="~/Content/images/logo2.png" data-holder-rendered="true" />
                                }
                            </a>
                        </div>
                        <div class="col company-details">
                            <div>
                                <h5 class="name" style="font-weight: bold;font-size: 1rem;">
                                    @ViewBag.sociedad
                                </h5>
                                <br />
                                <div class="form-group row" style="margin: auto; float: right">
                                    <h6 class="date">Fecha:</h6>
                                    <h6 class="text-gray-light" style="font-weight: bold; margin-left: 1rem">@ViewBag.fecha</h6>
                                </div>
                            </div>
                            <div></div>
                        </div>
                    </div>
                </header>
                <main>
                    <div class="row contacts">
                        <div class="col responsiva-to">
                            <div class="form-group row" style="margin: auto">
                                <h6 class="text-gray-light">Asignación a:</h6>
                                <h6 class="text-gray-light" style="font-weight: bold; margin-left: 1rem">@ViewBag.nombreCompleto</h6>
                            </div>
                            <div class="form-group row" style="margin: auto">
                                <h6 class="text-gray-light">Área:</h6>
                                <h6 class="address" style="font-weight: bold; margin-left: 1rem">@ViewBag.departamento</h6>
                            </div>
                            <div class="form-group row" style="margin: auto">
                                <h6 class="text-gray-light">Ubicación:</h6>
                                <h6 class="address" style="font-weight: bold; margin-left: 1rem">@ViewBag.ubicacion</h6>
                            </div>
                            <div class="form-group row" style="margin: auto">
                                <h6 class="text-gray-light">Correo:</h6>
                                <h6 class="email" style="font-weight: bold; margin-left: 1rem">@ViewBag.correo</h6>
                            </div>
                        </div>
                        <div class="col responsiva-details">
                            <h1 class="responsiva-id"></h1>
                        </div>
                    </div>
                    <br />
                    <div class="notices">
                        <div></div>
                        <div class="notice">
                            He recibido de la empresa lo siguiente:
                        </div>
                    </div>
                    <br />
                    <br />
                    <div class="col-lg-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body" style="margin-top: 0rem; padding: 0rem">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="tablaEquipos" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Marca</th>
                                                <th>Modelo</th>
                                                <th>Serie/Número/IMEI</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="notices">
                        <div></div>
                        <div class="notice">
                            En la presente garantizo el uso adecuado de los equipos, tengo conocimiento de que los equipos son a prestamo con la finalidad de uso para mi trabajo y debe utilzarse adecuadamente; asumo cualquier responsabilidad, por lo que, cualquier abuso reportado por dicha unidad, me será atribuido y deberé cubrir las consecuencias provocadas.
                            Asi mismo me obligo a reintegrar este equipo a la empresa cuando me sea requerido en las mejores condiciones posibles en las que se me ha entregado.
                        </div>
                    </div>
                    <br />
                    <br />
                    <div class="form-group row" style="padding-bottom: 2rem">
                        <label for="comentariosResponsiva" class="col-sm-3 col-form-label">Comentarios:</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" id="comentariosResponsiva" rows="5">@ViewBag.comentarios</textarea>
                        </div>
                    </div>
                    <div class="form-group row" id="divFirma" style="padding-bottom: 2rem">
                        <label for="descripcionTicket" class="col-sm-3 col-form-label">Firma usuario:</label>
                        <div class="col-sm-9">
                            <div class="form-group">
                                <div class="flex-row">
                                    <div class="wrapper">
                                        <canvas id="signature-pad" height="200"></canvas>
                                    </div>
                                    <div class="clear-btn">
                                        <button id="clear"><span> Limpiar </span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" id="divImagenFirma" style="padding-bottom: 2rem">
                        <label for="descripcionTicket" class="col-sm-3 col-form-label">Firma usuario:</label>
                        <div class="col-sm-9">
                            <div class="form-group">
                                <div class="flex-row">
                                    <div>
                                        <img id="imagen" height="200"></img>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    @if ((Convert.ToString(Session["idResponsiva"]) == "0"))
                    {
                        <input hidden readonly type="text" class="form-control" id="firmaTexto" value="@ViewBag.firma">
                    }
                    else
                    {
                        <input readonly hidden type="text" class="form-control" id="firmaTexto" value="@ViewBag.firma">
                    }
                </main>
                <footer>
                </footer>
            </div>
            <div>
            </div>
        </div>
    </div>
    <div class="toolbar hidden-print">
        <div class="text-right">
            <button class="btn btn-success" id="btnGuardar" onclick="guardarResponsiva()" style="margin-left:2rem; width:10rem"><i class="fa fa-file-pdf-o"></i> Guardar</button>
        </div>
    </div>
    <style>
        body {
            font-family: 'Cambay' !important;
            font-size: 0.875rem !important;
        }

        #responsiva {
            padding: 30px;
        }

        .responsiva {
            position: relative;
            background-color: #FFF;
            min-height: 680px;
            padding: 15px
        }

            .responsiva header {
                padding: 10px 0;
                margin-bottom: 20px;
                border-bottom: 1px solid #3989c6
            }

            .responsiva .company-details {
                text-align: right
            }

                .responsiva .company-details .name {
                    margin-top: 0;
                    margin-bottom: 0
                }

            .responsiva .contacts {
                margin-bottom: 20px
            }

            .responsiva .responsiva-to {
                text-align: left
            }

                .responsiva .responsiva-to .to {
                    margin-top: 0;
                    margin-bottom: 0
                }

            .responsiva .responsiva-details {
                text-align: right
            }

                .responsiva .responsiva-details .responsiva-id {
                    margin-top: 0;
                    color: #3989c6
                }

            .responsiva main {
                padding-bottom: 50px
            }

                .responsiva main .thanks {
                    margin-top: -100px;
                    font-size: 2em;
                    margin-bottom: 50px
                }

                .responsiva main .notices {
                    padding-left: 6px;
                    border-left: 6px solid #3989c6
                }

                    .responsiva main .notices .notice {
                        font-size: 1.2em
                    }

            .responsiva table {
                width: 100%;
                border-collapse: collapse;
                border-spacing: 0;
                margin-bottom: 20px
            }

                .responsiva table td, .responsiva table th {
                    padding: 15px;
                    background: #eee;
                    border-bottom: 1px solid #fff
                }

                .responsiva table th {
                    white-space: nowrap;
                    font-weight: 400;
                    font-size: 16px
                }

                .responsiva table td h3 {
                    margin: 0;
                    font-weight: 400;
                    color: #3989c6;
                    font-size: 1.2em
                }

                .responsiva table .qty, .responsiva table .total, .responsiva table .unit {
                    text-align: right;
                    font-size: 1.2em
                }

                .responsiva table .no {
                    color: #fff;
                    font-size: 1.6em;
                    background: #3989c6
                }

                .responsiva table .unit {
                    background: #ddd
                }

                .responsiva table .total {
                    background: #3989c6;
                    color: #fff
                }

                .responsiva table tbody tr:last-child td {
                    border: none
                }

                .responsiva table tfoot td {
                    background: 0 0;
                    border-bottom: none;
                    white-space: nowrap;
                    text-align: right;
                    padding: 10px 20px;
                    font-size: 1.2em;
                    border-top: 1px solid #aaa
                }

                .responsiva table tfoot tr:first-child td {
                    border-top: none
                }

                .responsiva table tfoot tr:last-child td {
                    color: #3989c6;
                    font-size: 1.4em;
                    border-top: 1px solid #3989c6
                }

                .responsiva table tfoot tr td:first-child {
                    border: none
                }

            .responsiva footer {
                width: 100%;
                text-align: center;
                color: #777;
                border-top: 1px solid #aaa;
                padding: 8px 0
            }


            .responsiva footer {
                position: absolute;
                bottom: 10px;
                page-break-after: always
            }

            .responsiva > div:last-child {
                page-break-before: always
            }

        {
            padding: 0;
            margin: 0;
        }

        .flex-row {
            display: flex;
            width: 100%;
        }

        .wrapper {
            border: 1px solid #c50000;
            border-right: 0;
            width: 100%;
        }

        canvas#signature-pad {
            background: #fff;
            width: 100%;
            height: 20rem;
            cursor: crosshair;
        }

        button#clear {
            height: 100%;
            background: #c50000;
            border: 1px solid transparent;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
        }

            button#clear span {
                transform: rotate(90deg);
                display: block;
            }
    </style>

    <script>

        if ($("#firmaTexto").val() == "")
        {
            document.getElementById("comentariosResponsiva").readOnly = false;
            $("#btnGuardar").show();
            $("#divFirma").show();
            $("#divImagenFirma").hide();
        }
        else
        {
            document.getElementById("comentariosResponsiva").readOnly = true;
            $("#imagen").attr('src', $("#firmaTexto").val());
            $("#btnGuardar").hide();
            $("#divFirma").hide();
            $("#divImagenFirma").show();
        }

        tablaEquipos = $("#tablaEquipos").DataTable({
            paging: false,
            ordering: false,
            info: false,
            lengthChange: false,
            searching: false,

            pageLength: 100,
                "language": {
                "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
            },

            "ajax": {
                url: '@Url.Action("obtener_datos_responsiva", "Responsiva")',
                type: "GET",
                dataType: "json",
            },

            "columns": [
                { data: 'tipoEquipo' },
                { data: 'marca' },
                { data: 'modelo' },
                { data: 'serie' }
            ],

        });

        var canvas = document.getElementById("signature-pad");

        function resizeCanvas()
        {
            var ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
        }
        window.onresize = resizeCanvas;
        resizeCanvas();

        var signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgb(250,250,250)'
        });

        document.getElementById("clear").addEventListener('click', function () {
            signaturePad.clear();
        })

        function guardarResponsiva()
        {
            const dataURL = canvas.toDataURL();

            var responsivaAsignacion = {
                firma: dataURL,
                comentarios: $("#comentariosResponsiva").val(),
            }

            jQuery.ajax({
                url: '@Url.Action("guardar_responsiva", "Responsiva")',
                type: "POST",
                data: JSON.stringify({ responsiva: responsivaAsignacion }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (resultado)
                {
                    swal("", "Firma guardada correctamente!", "success")
                        .then((value) =>
                        {
                            document.getElementById("comentariosResponsiva").readOnly = true;
                            $("#divImagenFirma").show();
                            $("#btnGuardar").hide();
                            $("#imagen").attr('src', dataURL);
                            $("#divFirma").hide();
                        });
                },
                error: function () {
                    swal("", "Ocurrio un error al guardar la firma!", "error");
                },
            });

        }

        /*
        function imprimir()
        {
            var divImpresion = document.getElementById("divImpresion");
            var options =
            {
                margin: 10,
                filename: "Responsiva.pdf",
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 3 },
                pagebreak: { mode: 'avoid-all', before: '#page2el' },
                jspdf: {format: 'letter', orientation: 'portrait'}

            }
            html2pdf().set(options).from(divImpresion).save();
        }
        */
    </script>
</body>
</html>
